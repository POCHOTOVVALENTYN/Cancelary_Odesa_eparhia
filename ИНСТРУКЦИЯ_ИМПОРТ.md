# Инструкция по импорту данных из Excel

## Обзор

Бот поддерживает импорт данных о священниках из Excel файлов. Это позволяет быстро загрузить большое количество данных без ручного ввода.

## Подготовка данных

### Вариант 1: Использование шаблона (рекомендуется)

1. **Создайте шаблон:**
   ```bash
   python excel_template.py
   ```
   
   Это создаст файл `template_priests.xlsx` с правильной структурой и примерами.

2. **Откройте шаблон в Excel:**
   - Файл содержит два листа:
     - "Священники" - для заполнения данных
     - "Инструкция" - подробные инструкции

3. **Заполните данные:**
   - Удалите примеры (строки 2-3)
   - Заполните данные о священниках
   - Сохраните файл

### Вариант 2: Создание файла вручную

Создайте Excel файл со следующими колонками:

| Колонка | Описание | Обязательное | Формат |
|---------|----------|--------------|--------|
| Имя | Имя священника | ✅ Да | Текст |
| Фамилия | Фамилия священника | ✅ Да | Текст |
| Дата рождения | Дата рождения | ❌ Нет | DD.MM.YYYY |
| Место рождения | Место рождения | ❌ Нет | Текст |
| Статус | Статус священника | ✅ Да | Протоиерей/Иерей/Диакон/Протодиакон |
| Дата рукоположения | Дата рукоположения | ❌ Нет | DD.MM.YYYY |
| Место служения | Место служения | ❌ Нет | Текст |
| Образование | Место обучения | ❌ Нет | Текст |
| Последняя награда | Последняя награда | ❌ Нет | Текст |

**Важно:**
- Названия колонок могут быть на русском или английском языке
- Поддерживаются различные варианты названий (см. ниже)
- Первая строка должна содержать заголовки

### Альтернативные названия колонок

Бот автоматически распознает различные варианты названий:

- **Имя**: Имя, Name, Имя священника
- **Фамилия**: Фамилия, Surname, Фамилия священника
- **Дата рождения**: Дата рождения, Birth Date, ДР, Дата_рождения
- **Место рождения**: Место рождения, Birth Place, Место_рождения
- **Статус**: Статус, Status, Сан, Звание
- **Дата рукоположения**: Дата рукоположения, Ordination Date, Дата_рукоположения
- **Место служения**: Место служения, Service Place, Место_служения, Храм, Приход
- **Образование**: Образование, Education, Учебное заведение
- **Последняя награда**: Последняя награда, Last Reward, Последняя_награда, Награда

## Импорт через бота

### Шаг 1: Отправка команды

Отправьте боту команду:
```
/import
```

Бот ответит инструкцией по использованию.

### Шаг 2: Отправка файла

1. Прикрепите Excel файл к сообщению в Telegram
2. Отправьте сообщение боту
3. Бот автоматически начнет обработку

### Шаг 3: Ожидание результата

Бот обработает файл и отправит отчет:
- Количество обработанных строк
- Количество успешно импортированных записей
- Количество ошибок (если есть)
- Детали ошибок (если есть)

## Конвертация Word → Excel

Если ваши данные находятся в Word документе:

### Автоматическая конвертация

```bash
python convert_word_to_excel.py ваш_файл.docx [выходной_файл.xlsx]
```

**Пример:**
```bash
python convert_word_to_excel.py priests.docx priests.xlsx
```

**Важно:** Автоматическая конвертация работает только для определенных форматов Word. Если конвертация не удалась:

1. Откройте Word файл в Excel напрямую (если это таблица)
2. Или скопируйте данные вручную в шаблон Excel
3. Используйте шаблон для правильного формата

### Ручная конвертация

1. Откройте Word документ
2. Если данные в таблице:
   - Выделите таблицу
   - Скопируйте (Ctrl+C)
   - Откройте Excel
   - Вставьте (Ctrl+V)
   - Сохраните как .xlsx

3. Если данные в текстовом формате:
   - Создайте шаблон: `python excel_template.py`
   - Скопируйте данные вручную
   - Сохраните файл

## Валидация данных

Бот автоматически проверяет данные при импорте:

### Обязательные поля
- Имя
- Фамилия
- Статус

### Валидация статуса
Статус должен быть одним из:
- Протоиерей
- Иерей
- Диакон
- Протодиакон

### Валидация дат
Даты должны быть в формате DD.MM.YYYY:
- ✅ Правильно: 01.01.1980, 15.05.2005
- ❌ Неправильно: 1/1/1980, 1980-01-01

### Дубликаты
Если священник с таким же именем и фамилией уже существует:
- Запись будет пропущена
- В отчете будет указана ошибка

## Обработка ошибок

### Типы ошибок

1. **Отсутствуют обязательные поля**
   - Решение: Заполните все обязательные колонки

2. **Неверный формат даты**
   - Решение: Используйте формат DD.MM.YYYY

3. **Неверный статус**
   - Решение: Используйте один из допустимых статусов

4. **Дубликат записи**
   - Решение: Проверьте, не существует ли уже такой священник

5. **Ошибка базы данных**
   - Решение: Проверьте логи бота, возможно проблема с БД

### Просмотр ошибок

Бот автоматически отправляет детальный отчет об ошибках:
- Номер строки с ошибкой
- Тип ошибки
- Данные из проблемной строки

## Примеры

### Пример 1: Простой импорт

1. Создайте файл `priests.xlsx`:
   ```
   Имя    | Фамилия | Статус      | Место служения
   -------|---------|-------------|------------------
   Иван   | Иванов  | Протоиерей  | Собор Святого Павла
   Петр   | Петров  | Иерей       | Храм Святого Николая
   ```

2. Отправьте боту: `/import`
3. Прикрепите файл `priests.xlsx`
4. Получите отчет об импорте

### Пример 2: Полный импорт с датами

```
Имя      | Фамилия | Дата рождения | Статус      | Дата рукоположения | Место служения
---------|---------|---------------|-------------|-------------------|------------------
Иван     | Иванов  | 01.01.1980    | Протоиерей  | 15.05.2005        | Собор Святого Павла
Петр     | Петров  | 15.03.1975    | Иерей       | 20.06.2000        | Храм Святого Николая
```

## Ограничения

- Максимальный размер файла: 20 МБ
- Поддерживаемые форматы: .xlsx, .xls
- Максимальная длина сообщения об ошибках: 4000 символов

## Рекомендации

1. **Используйте шаблон** - это гарантирует правильный формат
2. **Проверяйте данные перед импортом** - исправьте ошибки заранее
3. **Делайте резервные копии** - перед массовым импортом
4. **Импортируйте небольшими порциями** - для лучшего контроля
5. **Проверяйте отчеты** - обращайте внимание на ошибки

## Устранение неполадок

### Файл не обрабатывается

- Проверьте формат файла (.xlsx или .xls)
- Проверьте размер файла (максимум 20 МБ)
- Убедитесь, что вы администратор

### Ошибки при импорте

- Проверьте формат данных
- Убедитесь, что все обязательные поля заполнены
- Проверьте формат дат
- Проверьте статусы

### Бот не отвечает

- Проверьте, что бот запущен
- Проверьте логи бота
- Попробуйте отправить файл снова

## Дополнительная помощь

Если у вас возникли проблемы:
1. Проверьте эту инструкцию
2. Проверьте логи бота
3. Убедитесь, что используете правильный формат
4. Попробуйте создать новый файл из шаблона
