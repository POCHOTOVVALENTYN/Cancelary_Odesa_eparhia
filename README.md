# Telegram-бот для Одесской Епархии

Telegram-бот для предоставления информации о священниках Одесской Епархии.

## Описание

Этот бот позволяет пользователям получать информацию о священниках Одесской Епархии, включая:
- Имя и фамилию
- Статус (Протоиерей, Иерей, Диакон, Протодиакон)
- Дату рождения
- Место рождения
- Дату рукоположения
- Место служения
- Образование
- Последнюю награду

## Требования

- Python 3.8 или выше
- pip (менеджер пакетов Python)

## Установка

### Шаг 1: Клонирование или загрузка проекта

Если проект находится в репозитории, клонируйте его:
```bash
git clone <URL_репозитория>
cd Cancellary_Bot
```

Или просто перейдите в папку проекта, если файлы уже загружены.

### Шаг 2: Создание виртуального окружения (рекомендуется)

```bash
python3 -m venv venv
```

Активация виртуального окружения:

**На macOS/Linux:**
```bash
source venv/bin/activate
```

**На Windows:**
```bash
venv\Scripts\activate
```

### Шаг 3: Установка зависимостей

```bash
pip install -r requirements.txt
```

### Шаг 4: Получение токена бота

1. Откройте Telegram и найдите бота [@BotFather](https://t.me/BotFather)
2. Отправьте команду `/newbot`
3. Следуйте инструкциям и создайте нового бота
4. Скопируйте полученный токен (выглядит как `123456789:ABCdefGHIjklMNOpqrsTUVwxyz`)

### Шаг 5: Настройка конфигурации

Откройте файл `config.py` и выполните одно из следующих действий:

**Вариант 1: Установка через переменную окружения (рекомендуется)**

Установите переменную окружения:
```bash
export BOT_TOKEN="ваш_токен_здесь"
```

**Вариант 2: Прямое редактирование config.py**

Откройте `config.py` и замените:
```python
BOT_TOKEN = os.getenv("BOT_TOKEN", "YOUR_BOT_TOKEN_HERE")
```
на:
```python
BOT_TOKEN = os.getenv("BOT_TOKEN", "ваш_токен_здесь")
```

**Настройка администраторов:**

В файле `config.py` найдите `ADMIN_IDS` и добавьте ID пользователей, которые будут иметь права администратора:

```python
ADMIN_IDS: List[int] = [
    830196453,  # Замените на ваш Telegram ID
]
```

Чтобы узнать свой Telegram ID:
1. Найдите бота [@userinfobot](https://t.me/userinfobot) в Telegram
2. Отправьте ему команду `/start`
3. Скопируйте ваш ID

### Шаг 6: Запуск бота

```bash
python bot.py
```

Если всё настроено правильно, вы увидите сообщение:
```
Бот запущен и готов к работе!
```

## Использование

### Команды для пользователей

- `/start` - Приветствие и инструкция
- `/help` - Справка по командам
- `/search <имя или фамилия>` - Поиск священника
  - Пример: `/search Иванов`
- `/list` - Список всех священников (с пагинацией)
- `/status <статус>` - Фильтр по статусу
  - Пример: `/status протоиерей`
  - Доступные статусы: Протоиерей, Иерей, Диакон, Протодиакон

### Команды для администраторов

- `/import` - Импорт данных из Excel файла
- `/add` - Добавление нового священника (в разработке)
- `/edit` - Редактирование информации (в разработке)
- `/delete` - Удаление записи (в разработке)

### Примеры использования

1. **Поиск священника:**
   ```
   /search Петров
   ```

2. **Просмотр списка:**
   ```
   /list
   ```

3. **Фильтр по статусу:**
   ```
   /status иерей
   ```

4. **Простой поиск (без команды):**
   Просто отправьте имя или фамилию в чат, и бот выполнит поиск.

## Структура проекта

```
Cancellary_Bot/
├── bot.py              # Главный файл бота
├── database.py         # Работа с базой данных
├── models.py           # Модели данных
├── handlers.py         # Обработчики команд
├── config.py           # Конфигурация
├── utils.py            # Вспомогательные функции
├── requirements.txt    # Зависимости
├── README.md          # Этот файл
├── ARCHITECTURE.md    # Архитектура проекта
└── database.db        # База данных SQLite (создается автоматически)
```

## Импорт данных из Excel

### Быстрый старт

1. **Создайте шаблон Excel:**
   ```bash
   python excel_template.py
   ```
   Это создаст файл `template_priests.xlsx` с примером структуры.

2. **Заполните шаблон данными:**
   - Откройте созданный файл
   - Заполните данные о священниках
   - Удалите примеры (строки 2-3)
   - Сохраните файл

3. **Импортируйте через бота:**
   - Отправьте команду `/import` боту
   - Прикрепите Excel файл к сообщению
   - Бот автоматически обработает и импортирует данные

### Формат Excel файла

**Обязательные колонки:**
- Имя
- Фамилия
- Статус (Протоиерей, Иерей, Диакон, Протодиакон)

**Необязательные колонки:**
- Дата рождения (формат: DD.MM.YYYY)
- Место рождения
- Дата рукоположения (формат: DD.MM.YYYY)
- Место служения
- Образование
- Последняя награда

### Конвертация Word → Excel

Если у вас есть данные в Word документе:

```bash
python convert_word_to_excel.py ваш_файл.docx
```

**Примечание:** Автоматическая конвертация может требовать доработки под ваш формат Word. Рекомендуется:
1. Открыть Word файл в Excel напрямую (если это таблица)
2. Или вручную скопировать данные в шаблон Excel
3. Использовать созданный шаблон для правильного формата

## Добавление данных вручную

База данных создается автоматически при первом запуске. Для добавления данных о священниках вы можете:

1. **Использовать SQL-запросы напрямую:**
   ```python
   from database import Database
   from models import Priest
   from datetime import date
   
   db = Database()
   priest = Priest(
       name="Иван",
       surname="Иванов",
       birth_date=date(1980, 1, 1),
       birth_place="Одесса",
       status="Протоиерей",
       ordination_date=date(2005, 5, 15),
       service_place="Собор Святого Павла",
       education="Одесская духовная семинария",
       last_reward="Наперсный крест"
   )
   db.add_priest(priest)
   ```

2. **Использовать SQLite напрямую:**
   ```sql
   INSERT INTO priests (name, surname, birth_date, birth_place, status, ordination_date, service_place, education, last_reward)
   VALUES ('Иван', 'Иванов', '1980-01-01', 'Одесса', 'Протоиерей', '2005-05-15', 'Собор Святого Павла', 'Одесская духовная семинария', 'Наперсный крест');
   ```

## Развертывание на сервере

### Использование systemd (Linux)

Создайте файл `/etc/systemd/system/cancellary-bot.service`:

```ini
[Unit]
Description=Telegram Bot for Odessa Eparchy
After=network.target

[Service]
Type=simple
User=ваш_пользователь
WorkingDirectory=/путь/к/Cancellary_Bot
Environment="BOT_TOKEN=ваш_токен"
ExecStart=/usr/bin/python3 /путь/к/Cancellary_Bot/bot.py
Restart=always

[Install]
WantedBy=multi-user.target
```

Затем:
```bash
sudo systemctl daemon-reload
sudo systemctl enable cancellary-bot
sudo systemctl start cancellary-bot
```

### Использование screen/tmux

```bash
screen -S bot
python bot.py
# Нажмите Ctrl+A, затем D для отсоединения
```

## Устранение неполадок

### Бот не отвечает

1. Проверьте, что токен установлен правильно
2. Убедитесь, что бот запущен (проверьте логи)
3. Проверьте интернет-соединение

### Ошибки базы данных

1. Убедитесь, что у бота есть права на запись в директорию
2. Проверьте, что файл `database.db` не заблокирован другим процессом

### Проблемы с импортами

1. Убедитесь, что все зависимости установлены: `pip install -r requirements.txt`
2. Проверьте, что вы используете правильную версию Python (3.8+)

## Лицензия

Этот проект создан для использования в Одесской Епархии.

## Поддержка

При возникновении проблем создайте issue в репозитории проекта или свяжитесь с администратором.
